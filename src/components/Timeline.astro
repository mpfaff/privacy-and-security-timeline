---
import EndLabel from './EndLabel.astro';
import { parseDate } from '../dates.ts';

const { events } = Astro.props;

const firstEventDate = parseDate(events[0].date);
const lastEventDate = parseDate(events[events.length - 1].date);
---

<style>
  .timeline {
    display: inline-flex;
    align-items: center;
    flex-direction: column;
  }

  .timeline-wrapper {
    --padding: 4em;
    --line-width: 2px;
    --event-width: 500px;
    --event-timeline-offset: calc((var(--padding)) + 2px);
    --event-timeline-center: calc(var(--event-width) + (var(--event-timeline-offset)) + var(--line-width));

    position: relative;
    margin: 0 var(--padding);
  }

  .timeline-events {
    display: inline-flex;
    flex-direction: column;

    padding: 0;
    <!-- padding-right: var(--padding); -->

    border-right: var(--line-width) solid var(--line);
  }

  .timeline-line {
    position: absolute;
    width: var(--line-width);
    height: 100%;
    background: var(--line);
    border-radius: 2px;
    left: calc(var(--event-timeline-center));
  }

  .event {
    position: relative;

    list-style: none;

    width: var(--event-width);

    border: 1px solid var(--line);
    border-radius: 12px;
    background: var(--card);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;

    &::after {
      --width: 3em;
      --height: 2px;
    
      display: block;
      content: '';

      position: absolute;
      right: calc(var(--event-timeline-offset) * -1);
      /*top: calc(50% - (var(--height) / 2));*/
      top: calc(1.485em - (var(--height) / 2));

      height: var(--height);
      width: var(--width);

      background: var(--primary);
      opacity: 0.7;
    }

    &:nth-child(even) {
      margin-left: calc((var(--event-timeline-center)) + (var(--event-timeline-offset)));

      &::after {
        left: calc(var(--event-timeline-offset) * -1);
      }
    }
  }

  .event:hover {
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }

  .event-wrapper {
    margin: 16px;
  }

  .event-wrapper > div {
    font-size: 0.85em;
    color: var(--muted);
    margin-bottom: 0.5em;
  }

  .event-wrapper p {
    margin: 0.75em 0;
  }

  h2 {
    font-size: 1.125em;
    color: var(--primary);
  }

  h3 {
    font-size: 0.9em;
    margin-bottom: 0.2em;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .sources {
    font-size: 0.85em;
    padding-left: 1.2em;
    color: var(--muted);
  }

  .sources li {
    margin-bottom: 0.25em;
  }

  .sources a {
    color: var(--primary);
    text-decoration: none;
  }

  .sources a:hover {
    text-decoration: underline;
  }
</style>

<div class="timeline">
  <EndLabel date={firstEventDate} />
  <div class="timeline-wrapper">
    <div class="timeline-line"></div>
    <ol class="timeline-events">{events.map((event) => <li class="event">
      <div class="event-wrapper">
      	<h2 id={event.id}>{event.title}</h2>
      	<div>{event.date}</div>
      	<p>{event.description}</p>
        <h3>Sources</h3>
        <ul class="sources">{event.sources.map((source) =>
          <li><a href={source.url}>{source.title}</a>, <span class="source-site">{source.site}</span></li>)
        }</ul>
      </div>
    </li>)}<ol>
  </div>
  <EndLabel date={lastEventDate} />
</div>
